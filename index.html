<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CashPong</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico?v=2">
  <link rel="shortcut icon" type="image/x-icon" href="favicon.ico?v=2">
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
   <!-- Firebase App (compat version) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <!-- Firebase Auth (compat version) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <!-- Web3 pour MetaMask -->
  <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
  <!-- Ethers.js pour paiements avec Metamask -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <link rel="stylesheet" href="styles.css">
  <script src="event-handlers.js"></script>
</head>
<body>

<!-- Logo -->
<div style="text-align: center; padding: 15px 0;">
  <img src="hadi.png" alt="Logo" style="height: 80px; width: auto; max-width: 90%;">
</div>

<style>
/* Responsive logo for laptop screens */
@media (min-width: 769px) and (max-width: 1440px) {
  div[style*="text-align: center"] img[alt="Logo"] {
    height: 100px !important;
  }
}

@media (min-width: 1441px) {
  div[style*="text-align: center"] img[alt="Logo"] {
    height: 120px !important;
  }
}

/* Responsive buttons for laptop */
@media (min-width: 769px) and (max-width: 1440px) {
  #backToHome button, #languageToggle button {
    font-size: 13px !important;
    padding: 10px 18px !important;
  }
}

/* Responsive canvas container */
@media (max-width: 768px) {
  #myCanvas {
    width: calc(100vw - 20px) !important;
    height: auto !important;
  }
}

@media (min-width: 769px) and (max-width: 1440px) {
  #myCanvas {
    width: 90vw !important;
    max-width: 750px !important;
    height: auto !important;
  }
}
</style>

<!-- Back to Landing Page Button -->
<div id="backToHome" style="position: fixed; top: 10px; left: 10px; z-index: 1000;">
  <button onclick="goHome()" style="
    background: rgba(96,240,255,0.2);
    color: #60f0ff;
    border: 1px solid #60f0ff;
    padding: 8px 16px;
    border-radius: 20px;
    cursor: pointer;
    font-size: 12px;
    transition: all 0.3s ease;
  " onmouseover="this.style.background='#60f0ff'; this.style.color='#1a2233'" 
     onmouseout="this.style.background='rgba(96,240,255,0.2)'; this.style.color='#60f0ff'">
    ‚Üê Accueil
  </button>
</div>

<!-- Language Toggle Button -->
<div id="languageToggle" style="position: fixed; top: 20px; right: 20px; z-index: 1000;">
  <button onclick="toggleLanguage()" style="
    background: rgba(96,240,255,0.2);
    color: #60f0ff;
    border: 1px solid #60f0ff;
    padding: 8px 16px;
    border-radius: 20px;
    cursor: pointer;
    font-size: 12px;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 5px;
  " onmouseover="this.style.background='#60f0ff'; this.style.color='#1a2233'" 
     onmouseout="this.style.background='rgba(96,240,255,0.2)'; this.style.color='#60f0ff'">
    <span id="flagIcon">üá∫üá∏</span>
    <span id="langText">EN</span>
  </button>
</div>

  
</div>

  <div id="peerIdDisplay">Ton Peer ID : </div>

  <div id="authSection">
    <input type="text" id="username" placeholder="YOUR ID">
    <input type="email" id="email" placeholder="Adresse e-mail">
    <div class="password-container">
      <input type="password" id="password" placeholder="Mot de passe">
      <button type="button" class="password-toggle">üëÅÔ∏è</button>
    </div>    
    <button id="loginBtn">Se connecter</button>
    <button id="logoutBtn">D√©connecter</button>
    <button id="showCreateAccountBtn">Cr√©er un compte</button>
    <div class="forgot-password-container">
      <a href="#" id="resetPasswordLink" class="forgot-password-link">Mot de passe oubli√© ?</a>
    </div>
    <button id="forfeitBtn">
  Forfait
</button>
  </div>

  <div id="createAccountSection">
    <input type="text" id="newUsername" placeholder="Nom d'identifiant (ex: Jony)">
    <input type="email" id="newEmail" placeholder="Adresse e-mail">
    <div class="password-container">
      <input type="password" id="newPassword" placeholder="Mot de passe">
      <button type="button" class="password-toggle">üëÅÔ∏è</button>
    </div>
    <button id="createAccountBtn">Cr√©er mon compte</button>
    <button id="hideCreateAccountBtn">Annuler</button>
  </div>
 
  <!-- ü¶ä Section MetaMask - Toujours visible -->
  <div id="metamaskSection">
    <button id="connectWalletBtn">ü¶ä Connecter Metamask</button>
    <button id="forceReconnectBtn" class="force-reconnect-btn">üîÑ Force Reconnect</button>
    <span id="walletAddress"></span>
  </div>

  <div id="peerControls">
    <h3>üè† Cr√©er une Room</h3>
    <!-- ‚úÖ Adresse Ethereum de l'adversaire -->
    <input type="text" id="otherPeerId" placeholder="Adresse Ethereum de l'adversaire">
    <!-- ‚úÖ Mise en ETH -->
    <input type="number" id="betAmount" placeholder="Montant √† miser (ETH)" min="0.001" step="0.001">
    <!-- ‚úÖ Cr√©er room et miser -->
    <button id="betButton">Cr√©er Room & Miser</button>
    <div id="matchInfo"></div>
  </div>

  <div id="joinRoomControls">
    <h3>üéÆ Rejoindre une Room</h3>
    <!-- ‚úÖ Room ID √† rejoindre -->
    <input type="text" id="roomIdToJoin" placeholder="Room ID (ex: 1754854660945)">
    <!-- ‚úÖ Montant automatique affich√© -->
    <div id="joinBetDisplay" style="padding: 10px; background: #f0f0f0; border-radius: 5px; margin: 5px 0; display: none;">
      üí∞ Mise requise : <span id="joinBetAmountDisplay">-</span> ETH
    </div>
    <!-- ‚úÖ Rejoindre room et payer -->
    <button id="joinRoomButton">Rejoindre Room & Payer</button>
    <div id="joinInfo"></div>
  </div>

  <!-- üèÜ Contr√¥les de r√©clamation de victoire -->
  <div id="claimVictoryControls" style="display: none;">
    <h3>üèÜ R√©clamer Victoire</h3>
    <p>‚ö†Ô∏è Votre adversaire est inactif depuis plus de 60 secondes</p>
    <button id="claimVictoryButton">
      üèÜ R√©clamer Victoire & R√©cup√©rer Fonds
    </button>
    <div id="claimVictoryInfo"></div>
  </div>

  <canvas id="myCanvas" width="800" height="400"></canvas>

  <div id="playButtonContainer" style="position:fixed; bottom:30px; left:50%; transform:translateX(-50%); z-index:1000; text-align:center;">
    <button id="playButton">JOUER</button>
    <div id="waitingForHost" style="display:none; background:rgba(0,0,0,0.8); color:white; padding:10px; border-radius:5px; text-align:center; margin-top:10px;">
      En attente que l'h√¥te d√©marre la partie...
    </div>
  </div>



  <div id="gameOver"></div>

<div id="paymentSection">
  <p id="paymentMessage">F√©licitations ! Vous avez gagn√© üéâ Cliquez ci-dessous pour recevoir votre gain :</p>
  <button id="validatePaymentBtn">üí∞ Valider le paiement</button>
</div>

<!-- üí¨ Bouton de la bulle de chat -->
  <div id="chatBubble">
    üí¨
    <span id="unreadBadge">0</span>
  </div>

<!-- üí¨ Fen√™tre de chat cach√©e au d√©but -->
<div id="chatWindow">
  <div class="chat-header">
    Chat
  </div>
<div id="chatBox"></div>
  <div class="chat-input-container">
    <input id="chatInput" type="text" placeholder="√âcrivez un message...">
    <button id="sendMessageBtn" class="chat-send-btn">Envoyer</button>
  </div>
</div>

  <script>
    // Language data for game page
    const languages = {
      fr: {
        backButton: "‚Üê Accueil",
        peerIdDisplay: "Ton Peer ID : ",
        usernamePlaceholder: "YOUR ID",
        emailPlaceholder: "Adresse e-mail",
        passwordPlaceholder: "Mot de passe",
        loginBtn: "Se connecter",
        logoutBtn: "D√©connecter",
        showCreateAccountBtn: "Cr√©er un compte",
        resetPasswordLink: "Mot de passe oubli√© ?",
        forfeitBtn: "Forfait",
        newUsernamePlaceholder: "Nom d'identifiant (ex: Jony)",
        newEmailPlaceholder: "Adresse e-mail",
        newPasswordPlaceholder: "Mot de passe",
        createAccountBtn: "Cr√©er mon compte",
        hideCreateAccountBtn: "Annuler",
        connectWalletBtn: "ü¶ä Connecter Metamask",
        forceReconnectBtn: "üîÑ Force Reconnect",
        createRoomTitle: "üè† Cr√©er une Room",
        otherPeerPlaceholder: "Adresse Ethereum de l'adversaire",
        betAmountPlaceholder: "Montant √† miser (ETH)",
        betButton: "Cr√©er Room & Miser",
        joinRoomTitle: "üéÆ Rejoindre une Room",
        roomIdPlaceholder: "Room ID (ex: 1754854660945)",
        joinBetDisplay: "üí∞ Mise requise : ",
        joinRoomButton: "Rejoindre Room & Payer",
        claimVictoryTitle: "üèÜ R√©clamer Victoire",
        claimVictoryWarning: "‚ö†Ô∏è Votre adversaire est inactif depuis plus de 60 secondes",
        claimVictoryButton: "üèÜ R√©clamer Victoire & R√©cup√©rer Fonds",
        playButton: "JOUER",
        waitingForHost: "En attente que l'h√¥te d√©marre la partie...",
        paymentMessage: "F√©licitations ! Vous avez gagn√© üéâ Cliquez ci-dessous pour recevoir votre gain :",
        validatePaymentBtn: "üí∞ Valider le paiement",
        chatHeader: "Chat",
        chatPlaceholder: "√âcrivez un message...",
        sendMessageBtn: "Envoyer",
        opponentDisconnected: "üèÜ ADVERSAIRE D√âCONNECT√â - VOUS GAGNEZ !",
        forfeitClaimAvailable: "üèÜ ADVERSAIRE D√âCONNECT√â - VOUS GAGNEZ ! R√©clamation de forfait disponible dans :",
        forfeitClaimReady: "üèÜ ADVERSAIRE D√âCONNECT√â - VOUS GAGNEZ ! Cliquez sur le bouton ci-dessous pour r√©clamer votre paiement de victoire.",
        seconds: "secondes",
        // Nouveaux messages de jeu
        launchGame: "üöÄ LANCER LA PARTIE",
        waitingCreator: "‚è≥ EN ATTENTE DU CR√âATEUR",
        waitingOpponent: "‚è≥ En attente que l'adversaire rejoigne...",
        onlyCreatorCanStart: "Seul le cr√©ateur de la room peut lancer la partie",
        onlyCreatorCanStartAlert: "‚ùå Seul le cr√©ateur de la room peut lancer la partie.",
        youWin: "VOUS GAGNEZ !",
        youLose: "VOUS PERDEZ !",
        gameResult: "R√©sultat du jeu",
        playButton: "JOUER"
      },
      en: {
        backButton: "‚Üê Home",
        peerIdDisplay: "Your Peer ID: ",
        usernamePlaceholder: "YOUR ID",
        emailPlaceholder: "Email address",
        passwordPlaceholder: "Password",
        loginBtn: "Login",
        logoutBtn: "Logout",
        showCreateAccountBtn: "Create account",
        resetPasswordLink: "Forgot password?",
        forfeitBtn: "Forfeit",
        newUsernamePlaceholder: "Username (ex: Jony)",
        newEmailPlaceholder: "Email address",
        newPasswordPlaceholder: "Password",
        createAccountBtn: "Create my account",
        hideCreateAccountBtn: "Cancel",
        connectWalletBtn: "ü¶ä Connect Metamask",
        forceReconnectBtn: "üîÑ Force Reconnect",
        createRoomTitle: "üè† Create a Room",
        otherPeerPlaceholder: "Opponent's Ethereum address",
        betAmountPlaceholder: "Amount to bet (ETH)",
        betButton: "Create Room & Bet",
        joinRoomTitle: "üéÆ Join a Room",
        roomIdPlaceholder: "Room ID (ex: 1754854660945)",
        joinBetDisplay: "üí∞ Required bet: ",
        joinRoomButton: "Join Room & Pay",
        claimVictoryTitle: "üèÜ Claim Victory",
        claimVictoryWarning: "‚ö†Ô∏è Your opponent has been inactive for more than 60 seconds",
        claimVictoryButton: "üèÜ Claim Victory & Recover Funds",
        playButton: "PLAY",
        waitingForHost: "Waiting for host to start the game...",
        paymentMessage: "Congratulations! You won üéâ Click below to receive your winnings:",
        validatePaymentBtn: "üí∞ Validate payment",
        chatHeader: "Chat",
        chatPlaceholder: "Write a message...",
        sendMessageBtn: "Send",
        opponentDisconnected: "üèÜ OPPONENT DISCONNECTED - YOU WIN!",
        forfeitClaimAvailable: "üèÜ OPPONENT DISCONNECTED - YOU WIN! Forfeit claim available in:",
        forfeitClaimReady: "üèÜ OPPONENT DISCONNECTED - YOU WIN! Click the button below to claim your victory payment.",
        seconds: "seconds",
        // Game messages
        launchGame: "üöÄ START GAME",
        waitingCreator: "‚è≥ WAITING FOR CREATOR",
        waitingOpponent: "‚è≥ Waiting for opponent to join...",
        onlyCreatorCanStart: "Only the room creator can start the game",
        onlyCreatorCanStartAlert: "‚ùå Only the room creator can start the game.",
        youWin: "YOU WIN!",
        youLose: "YOU LOSE!",
        gameResult: "Game Result",
        playButton: "PLAY"
      }
    };

    let currentLanguage = 'fr';

    // Make languages globally available
    window.languages = languages;

    // Make toggleLanguage globally available
    window.toggleLanguage = function() {
      console.log('toggleLanguage called, current language:', currentLanguage);
      currentLanguage = currentLanguage === 'fr' ? 'en' : 'fr';
      console.log('New language:', currentLanguage);
      updateLanguage();
      localStorage.setItem('gameLanguage', currentLanguage);
    };

    window.updateLanguage = function() {
      console.log('updateLanguage called with language:', currentLanguage);
      const lang = languages[currentLanguage];
      console.log('Language object:', lang);
      
      // Update flag and language indicator
      const flagIcon = document.getElementById('flagIcon');
      const langText = document.getElementById('langText');
      
      if (flagIcon) {
        flagIcon.textContent = currentLanguage === 'fr' ? 'üá∫üá∏' : 'üá´üá∑';
        console.log('Updated flag icon:', flagIcon.textContent);
      }
      if (langText) {
        langText.textContent = currentLanguage === 'fr' ? 'EN' : 'FR';
        console.log('Updated lang text:', langText.textContent);
      }
      
      // Update back button
      const backButton = document.querySelector('#backToHome button');
      if (backButton) backButton.textContent = lang.backButton;
      
      // Update text content
      if (document.getElementById('peerIdDisplay')) document.getElementById('peerIdDisplay').textContent = lang.peerIdDisplay;
      if (document.getElementById('loginBtn')) document.getElementById('loginBtn').textContent = lang.loginBtn;
      if (document.getElementById('logoutBtn')) document.getElementById('logoutBtn').textContent = lang.logoutBtn;
      if (document.getElementById('showCreateAccountBtn')) document.getElementById('showCreateAccountBtn').textContent = lang.showCreateAccountBtn;
      if (document.getElementById('resetPasswordLink')) document.getElementById('resetPasswordLink').textContent = lang.resetPasswordLink;
      if (document.getElementById('forfeitBtn')) document.getElementById('forfeitBtn').textContent = lang.forfeitBtn;
      if (document.getElementById('createAccountBtn')) document.getElementById('createAccountBtn').textContent = lang.createAccountBtn;
      if (document.getElementById('hideCreateAccountBtn')) document.getElementById('hideCreateAccountBtn').textContent = lang.hideCreateAccountBtn;
      if (document.getElementById('connectWalletBtn')) document.getElementById('connectWalletBtn').textContent = lang.connectWalletBtn;
      if (document.getElementById('forceReconnectBtn')) document.getElementById('forceReconnectBtn').textContent = lang.forceReconnectBtn;
      if (document.getElementById('betButton')) document.getElementById('betButton').textContent = lang.betButton;
      if (document.getElementById('joinRoomButton')) document.getElementById('joinRoomButton').textContent = lang.joinRoomButton;
      if (document.getElementById('claimVictoryButton')) document.getElementById('claimVictoryButton').textContent = lang.claimVictoryButton;
      if (document.getElementById('playButton')) document.getElementById('playButton').textContent = lang.playButton;
      if (document.getElementById('validatePaymentBtn')) document.getElementById('validatePaymentBtn').textContent = lang.validatePaymentBtn;
      if (document.getElementById('sendMessageBtn')) document.getElementById('sendMessageBtn').textContent = lang.sendMessageBtn;
      
      // Update placeholders
      if (document.getElementById('username')) document.getElementById('username').placeholder = lang.usernamePlaceholder;
      if (document.getElementById('email')) document.getElementById('email').placeholder = lang.emailPlaceholder;
      if (document.getElementById('password')) document.getElementById('password').placeholder = lang.passwordPlaceholder;
      if (document.getElementById('newUsername')) document.getElementById('newUsername').placeholder = lang.newUsernamePlaceholder;
      if (document.getElementById('newEmail')) document.getElementById('newEmail').placeholder = lang.newEmailPlaceholder;
      if (document.getElementById('newPassword')) document.getElementById('newPassword').placeholder = lang.newPasswordPlaceholder;
      if (document.getElementById('otherPeerId')) document.getElementById('otherPeerId').placeholder = lang.otherPeerPlaceholder;
      if (document.getElementById('betAmount')) document.getElementById('betAmount').placeholder = lang.betAmountPlaceholder;
      if (document.getElementById('roomIdToJoin')) document.getElementById('roomIdToJoin').placeholder = lang.roomIdPlaceholder;
      if (document.getElementById('chatInput')) document.getElementById('chatInput').placeholder = lang.chatPlaceholder;
      
      // Update titles and headers
      const createRoomTitle = document.querySelector('#peerControls h3');
      if (createRoomTitle) createRoomTitle.textContent = lang.createRoomTitle;
      
      const joinRoomTitle = document.querySelector('#joinRoomControls h3');
      if (joinRoomTitle) joinRoomTitle.textContent = lang.joinRoomTitle;
      
      const claimVictoryTitle = document.querySelector('#claimVictoryControls h3');
      if (claimVictoryTitle) claimVictoryTitle.textContent = lang.claimVictoryTitle;
      
      const claimVictoryWarning = document.querySelector('#claimVictoryControls p');
      if (claimVictoryWarning) claimVictoryWarning.textContent = lang.claimVictoryWarning;
      
      const chatHeader = document.querySelector('.chat-header');
      if (chatHeader) chatHeader.textContent = lang.chatHeader;
      
      // Update other elements
      if (document.getElementById('waitingForHost')) document.getElementById('waitingForHost').textContent = lang.waitingForHost;
      if (document.getElementById('paymentMessage')) document.getElementById('paymentMessage').textContent = lang.paymentMessage;
      
      // Update join bet display text (keeping the amount)
      const joinBetDisplay = document.querySelector('#joinBetDisplay');
      if (joinBetDisplay && joinBetDisplay.textContent) {
        const amount = joinBetDisplay.querySelector('#joinBetAmountDisplay')?.textContent || '-';
        joinBetDisplay.innerHTML = `${lang.joinBetDisplay}<span id="joinBetAmountDisplay">${amount}</span> ETH`;
      }
      
      // Update game buttons with current state
      if (typeof updateGameButtonTexts === 'function') {
        updateGameButtonTexts();
      }
    }

    // Initialize language from localStorage or default to French
    window.initLanguage = function() {
      const savedLanguage = localStorage.getItem('gameLanguage');
      if (savedLanguage && languages[savedLanguage]) {
        currentLanguage = savedLanguage;
      }
      updateLanguage();
    };

    // Navigation function to go back to landing page
    window.goHome = function() {
      window.location.href = '/';
    };
    
    // Initialize language when page loads
    document.addEventListener('DOMContentLoaded', function() {
      initLanguage();
    });
  </script>
  
  <!-- Copyright Footer -->
  <div style="
    position: fixed; 
    bottom: 0; 
    left: 0; 
    right: 0; 
    background: rgba(26, 34, 51, 0.9); 
    color: #60f0ff; 
    text-align: center; 
    padding: 8px 0; 
    font-size: 12px; 
    border-top: 1px solid rgba(96, 240, 255, 0.2);
    z-index: 999;
  ">
    ¬© 2025 Cashpong. All rights reserved. | Powered by Blockchain Technology
  </div>
  
  <script src="script-li-khask-tchuf.js"></script>
</body>
</html>